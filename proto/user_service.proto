syntax = "proto3";

package user_service;
option go_package = "example/user_service";

import "google/api/annotations.proto";

service UserService {
    rpc AddUserDetails (AddUserDetailsRequest) returns (AddUserDetailsReply) {
    option (google.api.http) = {
      put: "/v1/user_service.UserService/AddUserDetails"
      body: "*"
    };
  }

  rpc GetUserDetails (GetUserDetailsRequest) returns (GetUserDetailsReply) {
    option (google.api.http) = {
      get: "/v1/user_service.UserService/GetUserDetails"
    };
  }

  rpc Login(LoginRequest) returns (AuthReply) {
    option (google.api.http) = {
      post: "/v1/user_service.UserService/Login"
      body: "*"
    };
  }
  rpc SignUp(SignUpRequest) returns (AuthReply) {
    option (google.api.http) = {
      post: "/v1/user_service.UserService/SignUp"
      body: "*"
    };
  }  
  rpc LinkUser (LinkUserRequest) returns (LinkUserReply) {
    option (google.api.http) = {
      post: "/v1/user_service.UserService/LinkUser"
      body: "*"
    };
  }
  rpc GetLinkedUsers (GetLinkedUsersRequest) returns (GetLinkedUsersReply) {
    option (google.api.http) = {
      post: "/v1/user_service.UserService/GetLinkedUsers"
      body: "*"
    };
  }

  rpc VerifyTokenRemote(VerifyTokenRequest) returns (VerifyTokenResponse) {}
    // internal grpc, not exposed to rest (for firestore.go)
}



message SignUpRequest {
  string email = 1;
  string password = 2;
}

message LoginRequest {
  string email = 1;
  string password = 2;
}

message AuthReply {
  string uid = 1; //may be null
  string id_token = 2; //may be null
  string message = 3;
}

message LinkUserRequest {
    string patient_token = 1; 
    string doctor_uid = 2;
    string relation_type = 3; // e.g. "doctor" (for filtering options, not nessesary)
}

message LinkUserReply {
    string message = 1;
}

message GetLinkedUsersRequest {
    string id_token = 1;
    string relation_type = 2; //optional for filtering
}

message RelatedUser {
    string uid = 1;
    string relation_type = 2;
}

message GetLinkedUsersReply {
    repeated RelatedUser related_users = 1;
}

message AddUserDetailsRequest {
  string id_token = 1; // identifies the user
  map<string, string> details = 2; // arbitrary key-value fields
}

message AddUserDetailsReply {
  string message = 1;
}

message GetUserDetailsRequest {
  string id_token = 1; // requester token
  string target_uid = 2; // optional - uid of related user
}

message GetUserDetailsReply {
  map<string, string> details = 1;
}


message VerifyTokenRequest { string id_token = 1; }
message VerifyTokenResponse { bool res = 1; string uid = 2; }

